<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Prueba de Polymer and Maps</title>
    <script src="bower_components/platform/platform.js"></script>
    <link rel="stylesheet" type="text/css" href="estilos.css">
    <link rel="import" href="bower_components/core-ajax/core-ajax.html">
  <link rel="import" href="bower_components/core-header-panel/core-header-panel.html">
  <link rel="import" href="bower_components/core-menu/core-menu.html">
  <link rel="import" href="bower_components/core-item/core-item.html">
  <link rel="import" href="bower_components/core-icon-button/core-icon-button.html">
  <link rel="import" href="bower_components/core-toolbar/core-toolbar.html">
  <link rel="import" href="bower_components/core-input/core-input.html">
  <link rel="import" href="bower_components/google-map/google-map.html">
  <link rel="import" href="bower_components/google-map/google-map-search.html">
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

</head>
<body fullbleed vertical layout unresolved>

        <core-header-panel mode="seamed" id="core_header_panel" navigation flex>
            <core-toolbar id="core_toolbar">
                <span>Tiulo</span>
            </core-toolbar>

            <template is="auto-binding" id="map"> 
              <core-ajax auto url="http://localhost:3000/api/pins" params='{"swLn":"{{$.google_map.sw.ln}}", "swLt":"{{$.google_map.sw.lt}}", "neLn": "{{$.google_map.ne.ln}}", "neLt": "{{$.google_map.ne.lt}}"}'  handleAs="json" class="api-ajax" response="{{response}}"></core-ajax>


                <google-map-search id="buscador" map="{{map}}" query="{{$.core_input.value}}" id="google_map_search" result="{{location}}"></google-map-search>
                <google-map map="{{map}}" latitude="{{location.latitude}}" longitude="{{location.longitude}}" zoom="17" id="google_map" disableDefaultUI>
                    <template repeat="{{response}}" class="template-ajax">
                        <google-map-marker latitude="{{location[1]}}" longitude="{{location[0]}}"></google-map-marker>
                    </template>
                </google-map>
                <div id="search-box">
                  <core-field>
                    <core-input willvalidate placeholder="Type something..." id="core_input"></core-input>
                    <core-icon icon="icons:search"></core-icon>
                  </core-field>
                </div>
                <script>
                    // Wait for 'polymer-ready'. Ensures the element is upgraded.
                    window.addEventListener('polymer-ready', function(e) {
                      var ajax = document.querySelector('.api-ajax');

                      // Respond to events it fires.
                      ajax.addEventListener('core-response', function(e) {
                         document.querySelector('.template-ajax').model = {
                            response: e.detail.response
                          };
                      });

                      ajax.go(); // Call its API methods.
                    });
                </script>
            </template>
        </core-header-panel>
        <div class="content">
        
        </div>
        <script>
        document.querySelector('google-map-search').search();
        </script>

  
  <script type="text/javascript">
    var map = document.querySelector("#map");

    navigator.geolocation.getCurrentPosition(GetLocation);
    function GetLocation(location) {
        var geo = function(latitude, longitude, accuracy){
            this.latitude = location.coords.latitude 
            this.longitude = location.coords.longitude 
            this.accuracy = location.coords.accuracy 
        }
        map.location = new geo();
        console.log(map.location); 
    }
  </script>
</body>
</html>